# IOWarp Core Header Update Guide

This guide explains how to update file headers in the IOWarp Core codebase and configure VSCode to automatically add headers to new files.

## Overview

The IOWarp Core project uses the BSD 3-Clause License. All source files should include the proper license header at the top of the file.

## Updating Existing Files

### Using the Update Script

The `update_headers.py` script automatically updates headers in C/C++ source files (`.h`, `.hpp`, `.cc`, `.cpp`, etc.).

#### Dry Run (Preview Changes)

To see what files would be modified without making changes:

```bash
python3 update_headers.py --dry-run
```

#### Update All Files

To update all C/C++ files in the repository:

```bash
python3 update_headers.py
```

#### Update Specific Directory

To update files in a specific directory:

```bash
python3 update_headers.py --path context-transfer-engine/
```

#### Update Single File

To update a specific file:

```bash
python3 update_headers.py --file src/myfile.cc
```

### What the Script Does

The script:
1. Finds all C/C++ source and header files
2. Removes old headers (including Hermes headers)
3. Adds the correct IOWarp BSD 3-Clause license header
4. Skips autogenerated files and third-party code
5. Preserves file content and formatting

### Excluded Directories

The following directories are automatically skipped:
- `build/`, `venv/`, `.git/`
- `third_party/`, `external/`, `_deps/`
- `CMakeFiles/`, `Testing/`
- Autogenerated files matching `*autogen*`, `*_generated.*`, `*.pb.*`

## VSCode Integration for New Files

### Installing the Extension

VSCode can automatically add headers to new files using the **psioniq File Header** extension.

1. Open VSCode
2. Go to Extensions (Ctrl+Shift+X or Cmd+Shift+X)
3. Search for "psioniq File Header"
4. Install the extension by psioniq

### Configuration

The VSCode settings have been pre-configured in `.vscode/settings.json` with:
- IOWarp BSD 3-Clause license header template
- Automatic year insertion
- Proper comment formatting for C/C++/Python files

### Using the Extension

#### Automatic Header on New Files

When you create a new file:
1. Create the file in VSCode
2. Press `Ctrl+Alt+H` (or `Cmd+Alt+H` on Mac)
3. The header will be automatically inserted

You can also use the Command Palette:
- Press `Ctrl+Shift+P` (or `Cmd+Shift+P`)
- Type "Insert Header"
- Select "psioniq.com: Insert Header"

#### Manual Header Insertion

For existing files without headers:
1. Open the file
2. Place cursor at the top of the file
3. Press `Ctrl+Alt+H` (or use Command Palette)

### Keybindings

Default keybinding: `Ctrl+Alt+H` (Windows/Linux) or `Cmd+Alt+H` (Mac)

To customize, add to `.vscode/keybindings.json`:
```json
[
    {
        "key": "ctrl+alt+h",
        "command": "psi-header.insertFileHeader"
    }
]
```

## Header Template

The standard IOWarp header is:

```c
/*
 * Copyright (c) 2024, Gnosis Research Center, Illinois Institute of Technology
 * All rights reserved.
 *
 * This file is part of IOWarp Core.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * 3. Neither the name of the copyright holder nor the names of its
 *    contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */
```

## Troubleshooting

### Script Issues

**Problem**: Script reports encoding errors
- **Solution**: The file may have binary content or non-UTF-8 encoding. The script will skip these files automatically.

**Problem**: Script modifies autogenerated files
- **Solution**: Check that the file path contains `autogen`, `_generated`, or similar patterns. Add new patterns to `SKIP_PATTERNS` in the script if needed.

### VSCode Extension Issues

**Problem**: Extension not inserting headers
- **Solution**:
  1. Verify the extension is installed: Extensions → search "psioniq File Header"
  2. Reload VSCode window: Command Palette → "Developer: Reload Window"
  3. Check settings are loaded: Settings → search "psi-header"

**Problem**: Wrong header format
- **Solution**: Check `.vscode/settings.json` has the correct `psi-header.templates` configuration

**Problem**: Header inserted in wrong location
- **Solution**: Set `"psi-header.config.forceToTop": true` in settings

## Best Practices

1. **Run dry-run first**: Always use `--dry-run` to preview changes before applying them
2. **Commit before updating**: Commit your work before running the update script so you can review changes
3. **Review changes**: Use `git diff` to review header changes before committing
4. **Don't modify autogenerated files**: The script excludes them, but if you manually edit one, don't add headers
5. **Use VSCode extension**: For new files, use the VSCode extension rather than manually typing headers

## Example Workflow

### Updating an Entire Component

```bash
# Preview changes
python3 update_headers.py --path context-transfer-engine/ --dry-run

# Review the output, then apply
python3 update_headers.py --path context-transfer-engine/

# Review changes with git
git diff context-transfer-engine/

# If satisfied, commit
git add context-transfer-engine/
git commit -m "Update headers in CTE to IOWarp license"
```

### Creating a New File in VSCode

1. Create new file: `src/my_new_feature.cc`
2. Press `Ctrl+Alt+H` to insert header
3. Start writing your code below the header

## Files

- `.header_template` - Template file for the license header
- `update_headers.py` - Script to update existing files
- `.vscode/settings.json` - VSCode configuration for automatic headers
- `HEADER_UPDATE_GUIDE.md` - This guide

## References

- [BSD 3-Clause License](https://opensource.org/licenses/BSD-3-Clause)
- [psioniq File Header Extension](https://marketplace.visualstudio.com/items?itemName=psioniq.psi-header)
- License file: `/workspace/LICENSE`
